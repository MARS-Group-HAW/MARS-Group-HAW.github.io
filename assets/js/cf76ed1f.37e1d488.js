"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3723],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>f});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=s(n),d=i,f=u["".concat(p,".").concat(d)]||u[d]||c[d]||r;return n?a.createElement(f,o(o({ref:t},m),{},{components:n})):a.createElement(f,o({ref:t},m))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},17589:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(87462),i=(n(67294),n(3905));const r={sidebar_position:1},o="Creating a model",l={unversionedId:"tutorial/development/createing-a-model",id:"tutorial/development/createing-a-model",title:"Creating a model",description:"This explains how the Program.cs works and how to setup a model from scratch.",source:"@site/docs/tutorial/development/createing-a-model.md",sourceDirName:"tutorial/development",slug:"/tutorial/development/createing-a-model",permalink:"/docs/tutorial/development/createing-a-model",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial/development/createing-a-model.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Development",permalink:"/docs/category/development"},next:{title:"ModelDescription",permalink:"/docs/tutorial/development/model"}},p={},s=[{value:"Setup C# project",id:"setup-c-project",level:2},{value:"Setting up an Entry Point",id:"setting-up-an-entry-point",level:2},{value:"Describe your model",id:"describe-your-model",level:2},{value:"Create the simulation configuration in code",id:"create-the-simulation-configuration-in-code",level:2},{value:"Use external simulation configurations (JSON)",id:"use-external-simulation-configurations-json",level:2},{value:"Build the application and run the simulation",id:"build-the-application-and-run-the-simulation",level:2},{value:"Store agent trips in GeoJSON file",id:"store-agent-trips-in-geojson-file",level:2}],m={toc:s};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"creating-a-model"},"Creating a model"),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This explains how the ",(0,i.kt)("inlineCode",{parentName:"p"},"Program.cs")," works and how to setup a model from scratch.")),(0,i.kt)("h2",{id:"setup-c-project"},"Setup C# project"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Download and install Microsoft ",(0,i.kt)("a",{parentName:"p",href:"https://dotnet.microsoft.com/download"},".NET Core"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Download and install ",(0,i.kt)("em",{parentName:"p"},"latest")," JetBrains ",(0,i.kt)("a",{parentName:"p",href:"https://www.jetbrains.com/de-de/rider/download/other.html"},"Rider IDE"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open Rider and click New Solution \u2192 Console Application (.NET Core)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Give your model a name, specify the directory, and click Create."),(0,i.kt)("p",{parentName:"li"},"Your initial model should look like this:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'using System;\nnamespace firstMars\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            Console.WriteLine("Hello World!");\n        }\n    }\n}\n')),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In the Project Structure window (left), right-click Dependencies \u2192 Manage NuGet Packages. Alternatively, you can click NuGet at the bottom left of the screen.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Search for Mars.Life.Simulations")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Install the package for your project")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open Program.cs and type ",(0,i.kt)("inlineCode",{parentName:"p"},"using Mars.")," at the top of the file to see if it leads to an error (this happens in some cases and is due to a bug in Rider.)."),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"If there is no error, you are done."),(0,i.kt)("li",{parentName:"ol"},"If there is an error, open the Terminal in Rider and execute ",(0,i.kt)("inlineCode",{parentName:"li"},"dotnet restore --force"),". Then, restart Rider and retry the import.")))),(0,i.kt)("h2",{id:"setting-up-an-entry-point"},"Setting up an Entry Point"),(0,i.kt)("p",null,"Starting a simulation required an entry point of execution. In default cases of programming this is the so called ",(0,i.kt)("inlineCode",{parentName:"p"},"Main")," (in Java ",(0,i.kt)("inlineCode",{parentName:"p"},"main"),"; in Python ",(0,i.kt)("inlineCode",{parentName:"p"},"__main__"),"). This method have to be provided by the model itself. "),(0,i.kt)("p",null,"Create a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"Program.cs"),". Define a class called ",(0,i.kt)("inlineCode",{parentName:"p"},"Program")," containing ",(0,i.kt)("strong",{parentName:"p"},"static")," method ",(0,i.kt)("inlineCode",{parentName:"p"},"Main(string[] arguments)"),". "),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This is the default for each .Net program you write, nothing special for MARS")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Program {\n\n}\n")),(0,i.kt)("p",null,"Thats it, now you can start your .NET program. \u2728 "),(0,i.kt)("h2",{id:"describe-your-model"},"Describe your model"),(0,i.kt)("p",null,"At the beginning of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Main"),", a ModelDescription (let's call it ",(0,i.kt)("inlineCode",{parentName:"p"},"description"),") is defined. It contains all layer types and agent types that are part of the model."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public static void Main(string[] args)\n{\n    var description = new ModelDescription();\n\n    description.AddLayer<Layer1>();\n    description.AddLayer<Layer2>();\n    description.AddAgent<Agent1, Layer1>();\n")),(0,i.kt)("h2",{id:"create-the-simulation-configuration-in-code"},"Create the simulation configuration in code"),(0,i.kt)("p",null,"In order to define a simulation configuration that exists within the ",(0,i.kt)("inlineCode",{parentName:"p"},"Main"),", a SimulationConfig (let's call it ",(0,i.kt)("inlineCode",{parentName:"p"},"config"),") object can be created. The code that defines the configuration can be written in a method outside of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Main"),", as seen in the following example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var config = CreateDefaultConfig();\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'private static SimulationConfig CreateDefaultConfig()\n{\n    var startPoint = DateTime.Parse("2020-01-01T00:00:00");\n    var config = new SimulationConfig\n    {\n        SimulationIdentifier = "green4bikes",\n        Globals =\n        {\n            StartPoint = startPoint,\n            EndPoint = startPoint + TimeSpan.FromHours(24),\n            DeltaTUnit = TimeSpanUnit.Seconds,\n            ShowConsoleProgress = true,\n            OutputTarget = OutputTargetType.Csv,\n            // simulation output formats\n        },\n        // layer configuration\n        // agent configuration\n    };\n    return config;\n}\n')),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Example"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"StartPoint")),(0,i.kt)("td",{parentName:"tr",align:null},"the start time of the simulation"),(0,i.kt)("td",{parentName:"tr",align:null},"01.01.2020")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"EndPoint")),(0,i.kt)("td",{parentName:"tr",align:null},"the end time of the simulation"),(0,i.kt)("td",{parentName:"tr",align:null},"31.01.2020")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DeltaTUnit")),(0,i.kt)("td",{parentName:"tr",align:null},"the unit of a single time step"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"TimeSpanUnit.Seconds"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ShowConsoleProgress")),(0,i.kt)("td",{parentName:"tr",align:null},"if ",(0,i.kt)("inlineCode",{parentName:"td"},"true"),", the simulation progress is displayed in the terminal"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"true")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"false"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"OutputTarget")),(0,i.kt)("td",{parentName:"tr",align:null},"the medium into which simulation output data is stored (set to csv in the above example)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"csv"))))),(0,i.kt)("p",null,"For more information on simulation output formats, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/sim_output_formats"},"here"),"."),(0,i.kt)("p",null,"For more information on layer configuration, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/layer_config"},"here"),"."),(0,i.kt)("p",null,"For more information on agent configuration, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/agent_config"},"here"),"."),(0,i.kt)("h2",{id:"use-external-simulation-configurations-json"},"Use external simulation configurations (JSON)"),(0,i.kt)("p",null,"In order to define a simulation configuration that exist outside of the model, a JSON file can be created as seen in the following example:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Globals"),": in this section, the simulation's global parameters are set. Here is an example:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},'{\n  "globals": {\n    "startPoint": "2020-01-01T00:00:00",\n    "endPoint": "2020-01-01T01:00:00",\n    "deltaT": 1,\n    "deltaTUnit": "seconds",\n    "console": true,\n    "output": "csv",\n    // simulation output formats\n  },\n')))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"startPoint"),": the start time of the simulation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"endPoint"),": the end time of the simulation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"deltaT"),": the length of a single time step"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"deltaTUnit"),": the unit of a single time step"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"console"),": if ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),", the simulation progress is displayed in the terminal"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"output"),": the medium into which simulation output data is stored")),(0,i.kt)("p",null,"For more information on simulation output formats, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/sim_output_formats"},"here"),"."),(0,i.kt)("p",null,"For more information on layer configuration, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/layer_config"},"here"),"."),(0,i.kt)("p",null,"For more information on agent configuration, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/agent_config"},"here"),"."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"build-the-application-and-run-the-simulation"},"Build the application and run the simulation"),(0,i.kt)("p",null,"Now that a ModelDescription and a configuration (a SimulationConfig (Part2a) or an external JSON file (Part2b)) of the model exists, an ",(0,i.kt)("inlineCode",{parentName:"p"},"ISimulationContainer")," object (let's call it ",(0,i.kt)("inlineCode",{parentName:"p"},"application"),") can be created. ",(0,i.kt)("inlineCode",{parentName:"p"},"application")," receives ",(0,i.kt)("inlineCode",{parentName:"p"},"description")," and the simulation configuration of your choice in order to execute the simulation."),(0,i.kt)("p",null,"In the following example, the simulation configuration is chosen during an if-else-statement. The ",(0,i.kt)("inlineCode",{parentName:"p"},"Main")," checks if an argument (a path to an external simulation configuration) was passed at the time of execution. If yes, then the program attempts to use the external information to configure the model (see if-branch). If no, then the internal model configuration (Part 2a) is used (see else-branch)."),(0,i.kt)("p",null,"The simulation is started by resolving the application and calling ",(0,i.kt)("inlineCode",{parentName:"p"},"StartSimulation()"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'    ISimulationContainer application;\n\n    if (args != null && args.Any())\n    {\n        var file = File.ReadAllText(Path.Combine(ResourcesConstants.SimConfigFolder, args[0]));\n        var simConfig = SimulationConfig.Deserialize(file);\n        Console.WriteLine($"Use simulation config: {args[0]}");\n        Console.WriteLine(simConfig.Serialize());\n        application = SimulationStarter.BuildApplication(description, simConfig);\n    }\n    else\n    {\n        Console.WriteLine("Use default simulation config:");\n        Console.WriteLine(config.Serialize());\n        application = SimulationStarter.BuildApplication(description, config);\n    }\n\n    var simulation = application.Resolve<ISimulation>();\n\n    var watch = Stopwatch.StartNew();\n    var state = simulation.StartSimulation();\n\n    // optional: store agent trips in external GEOJSON file (see Part 4 below)\n\n    watch.Stop();            \n    Console.WriteLine($"Executed iterations {state.Iterations} lasted {watch.Elapsed}");\n    application.Dispose();\n}\n')),(0,i.kt)("h2",{id:"store-agent-trips-in-geojson-file"},"Store agent trips in GeoJSON file"),(0,i.kt)("p",null,"In order to store agent trips (for later analysis and visualization), the following code can be added to the example in Part 3."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var layers = state.Model.AllActiveLayers;\nforeach (var layer in layers)\n{\n    if (layer is CitizenLayer citizenLayer)\n    {\n    var citizens = citizenLayer.PedestrianMap.Values;\n    TripsOutputAdapter.PrintTripResult(citizens);\n    }\n}\n")),(0,i.kt)("p",null,"For more information on agent trips and visualization of agent movement, please click ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/analysis/visualizing_agent_trips_kepler"},"here"),"."))}u.isMDXComponent=!0}}]);