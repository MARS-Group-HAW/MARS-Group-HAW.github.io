"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9721],{35332:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tutorial/soh/layers/scheduling_layer","title":"Scheduler Layer","description":"The scheduling layer can be used to connect time events to specific locations. Such an event can be used for event management or the creation of new agents.","source":"@site/docs/tutorial/soh/layers/scheduling_layer.md","sourceDirName":"tutorial/soh/layers","slug":"/tutorial/soh/layers/scheduling_layer","permalink":"/docs/tutorial/soh/layers/scheduling_layer","draft":false,"unlisted":false,"editUrl":"https://github.com/MARS-Group-HAW/MARS-Group-HAW.github.io/edit/main/docs/tutorial/soh/layers/scheduling_layer.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Multimodal Layer","permalink":"/docs/tutorial/soh/layers/multi_modal_layer"},"next":{"title":"Vector Layer","permalink":"/docs/tutorial/soh/layers/vector_layer"}}');var i=r(74848),d=r(28453);const s={},a="Scheduler Layer",l={},c=[{value:"Definition of Scheduler Layer",id:"definition-of-scheduler-layer",level:2},{value:"Scheduling Layer parameters",id:"scheduling-layer-parameters",level:2},{value:"Scheduling for Agent Creation",id:"scheduling-for-agent-creation",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"scheduler-layer",children:"Scheduler Layer"})}),"\n",(0,i.jsx)(n.p,{children:"The scheduling layer can be used to connect time events to specific locations. Such an event can be used for event management or the creation of new agents."}),"\n",(0,i.jsxs)(n.p,{children:["The model for the ",(0,i.jsx)(n.code,{children:"SchedulerLayer"})," looks like this:"]}),"\n",(0,i.jsx)(n.mermaid,{value:"classDiagram\n\n    class SchedulerLayer {\n        <<abstract>>\n        # SchedulerLayer()\n        # SchedulerLayer(table:DataTable)\n        + ^InitLayer(layerInitData:TInitData, register:RegisterAgent, unregistere:UnregisterAgent) bool\n        + ^PreTick() void\n        # Schedule(dataRow:SchedulerEntry)* void\n    }\n\n    AbstractActiveLayer <|-- SchedulerLayer\n    SchedulerLayer --\x3e IntervalTree2 : TimeSeries~DateTime,SchedulerEntry~\n    SchedulerLayer --\x3e DataTable : SchedulingTable"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"SchedulerLayer"})," is an ",(0,i.jsx)(n.strong,{children:"active"})," layer (more about active layers can be found ",(0,i.jsx)(n.a,{href:"/docs/tutorial/development/layers",children:"here"}),") and queries the ",(0,i.jsx)(n.code,{children:"TimeSeries"})," depending on the current simulation time."]}),"\n",(0,i.jsx)(n.p,{children:"The layer manages a time series to several profile data containing a source geometry and optionally a target geometry."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Compared to concrete input CSV for the creation of agents, agent profiles can be defined to avoid having to prepare concrete instances with individual parameterization."})}),"\n",(0,i.jsx)(n.h2,{id:"definition-of-scheduler-layer",children:"Definition of Scheduler Layer"}),"\n",(0,i.jsxs)(n.p,{children:["To define your own scheduling layer, you have to define a new class which inherits from the abstract class ",(0,i.jsx)(n.code,{children:"SchedulerLayer"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["First, a ",(0,i.jsx)(n.code,{children:"using"})," import of the namespace has to be done:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"using SOHDomain.Common;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now a new class can be defined that inherits from the ",(0,i.jsx)(n.code,{children:"SchedulerLayer"}),". As soon as an inheritance hierarchy has been defined, the method ",(0,i.jsx)(n.code,{children:"Schedule"})," is expected to be implemented:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public class MySchedulerLayer : SchedulerLayer \n{\n    public override void Schedule(SchedulerEntry dataRow) \n    {\n        // do your scheduled logic here\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Schedule"})," method is called exactly when there is an entry with a valid period. A ",(0,i.jsx)(n.code,{children:"SchedulerEntry"})," is passed with the call which contains the content of the entry from the table which is valid at this time."]}),"\n",(0,i.jsxs)(n.p,{children:["The model for the ",(0,i.jsx)(n.code,{children:"SchedulerEntry"})," looks like this:"]}),"\n",(0,i.jsx)(n.mermaid,{value:"classDiagram\n    class SchedulerEntry {\n        + SpawningIntervalInMinutes : int\n        + SpawningAmount int\n    }\n    \n    class IDictionary~T1,T2~ {\n    }\n\n    SchedulerEntry --\x3e IDictionary : Data~string,object~\n    SchedulerEntry --\x3e DateTime : StartValidTime\n    SchedulerEntry --\x3e DateTime : EndValidTime\n    SchedulerEntry --\x3e IGeometry : SourceGeometry \n    SchedulerEntry --\x3e IGeometry : TargetGeometry "}),"\n",(0,i.jsx)(n.h2,{id:"scheduling-layer-parameters",children:"Scheduling Layer parameters"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"SchedulerLayer"})," expects a tabular input of the form:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"startTime"}),(0,i.jsx)(n.th,{children:"endTime"}),(0,i.jsx)(n.th,{children:"spawningIntervalInMinutes"}),(0,i.jsx)(n.th,{children:"spawningAmount"}),(0,i.jsx)(n.th,{children:"sourceX"}),(0,i.jsx)(n.th,{children:"sourceY"}),(0,i.jsx)(n.th,{children:"destinationX"}),(0,i.jsx)(n.th,{children:"destinationY"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7:00"}),(0,i.jsx)(n.td,{children:"18:00"}),(0,i.jsx)(n.td,{children:"30"}),(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"9.95253"}),(0,i.jsx)(n.td,{children:"53.54907"}),(0,i.jsx)(n.td,{children:"9.92812"}),(0,i.jsx)(n.td,{children:"53.52143"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5:00"}),(0,i.jsx)(n.td,{children:"14:00"}),(0,i.jsx)(n.td,{children:"60"}),(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"9.91582"}),(0,i.jsx)(n.td,{children:"53.54836"}),(0,i.jsx)(n.td,{children:"9.92797"}),(0,i.jsx)(n.td,{children:"53.50674"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"16:00"}),(0,i.jsx)(n.td,{children:"23:00"}),(0,i.jsx)(n.td,{children:"60"}),(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"9.97033"}),(0,i.jsx)(n.td,{children:"53.54898"}),(0,i.jsx)(n.td,{children:"9.949668"}),(0,i.jsx)(n.td,{children:"53.531397"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9:00"}),(0,i.jsx)(n.td,{children:"20:00"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"9.98911"}),(0,i.jsx)(n.td,{children:"53.54531"}),(0,i.jsx)(n.td,{children:"9.891536"}),(0,i.jsx)(n.td,{children:"53.534310"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6:00"}),(0,i.jsx)(n.td,{children:"9:00"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"4"}),(0,i.jsx)(n.td,{children:"9.87707"}),(0,i.jsx)(n.td,{children:"53.53461"}),(0,i.jsx)(n.td,{children:"9.97969"}),(0,i.jsx)(n.td,{children:"53.54480"})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"startTime"})," (including) and the ",(0,i.jsx)(n.code,{children:"endTime"})," (exclusive) each indicate the lower and upper interval bounds in hours of the day. It defines the time range of the day when new scheduling is triggered in the simulation."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"spawningIntervalInMinutes"})," (e.g. ",(0,i.jsx)(n.code,{children:"30"}),", for every half hour) allows to repeat the creation of scheduling events starting with the ",(0,i.jsx)(n.code,{children:"startTime"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"spawningAmount"})," of scheduling event. Describes how often the ",(0,i.jsx)(n.code,{children:"Schedule"})," method should be called when a valid time is reached."]}),"\n",(0,i.jsxs)(n.li,{children:["To describe spawning source-target location, the scheduler offers two different parameterizations:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A concrete source and destination coordinate can be defined in ",(0,i.jsx)(n.code,{children:"WGS84:4326"})," notation via the fields ",(0,i.jsx)(n.code,{children:"sourceX"})," (longitude) and ",(0,i.jsx)(n.code,{children:"sourceY"})," (latitude) for the source and ",(0,i.jsx)(n.code,{children:"destinationX"}),"(longitude) and ",(0,i.jsx)(n.code,{children:"destinationY"})," (latitude) for defining an ",(0,i.jsx)(n.strong,{children:"optional"})," target (e.g. ",(0,i.jsx)(n.code,{children:"9.95253, 53.54907"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["A source geometry can be defined via the ",(0,i.jsx)(n.code,{children:"source"})," field (see polygon areas in the figure above) using the ",(0,i.jsx)(n.code,{children:"WKT"})," (well-known-text) format with ",(0,i.jsx)(n.code,{children:"WGS84:4326"})," notation to designate areas, lines, and points in the simulation world (e.g. B. ",(0,i.jsx)(n.code,{children:"POLYGON((9.976880157282743 53.5447212390353,9.983403289606962 53.54446623736498,9.980656707575712 53.54240066721653,9.976880157282743 53.5447212390353))"}),"). For lines and polygons (areas) the model selects ",(0,i.jsx)(n.strong,{children:"equidistributed randomly"})," a coordinate that either lies along the line or is inside the described area. A helpful tool to define own WKT vector or selecting coordinates is the online ",(0,i.jsx)(n.a,{href:"http://dev.openlayers.org/examples/vector-formats.html",children:"Openlayers"})," tool."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["More information in contrast to a specialized ",(0,i.jsx)(n.code,{children:"SchedulingLayer"})," implementation can be provided by using the ",(0,i.jsx)(n.code,{children:"Data"})," attribute in the ",(0,i.jsx)(n.code,{children:"SchedulerEntry"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"scheduling-for-agent-creation",children:"Scheduling for Agent Creation"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"SchedulingLayer"})," can be used directly to create agents. In the ",(0,i.jsx)(n.code,{children:"Schedule"})," implementation, agents can be created directly by calling the ",(0,i.jsx)(n.code,{children:"new"})," constructor."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public class CycleTravelerSchedulerLayer : SchedulerLayer\n{\n    public TravelerLayer TravelerLayer { get; set; }\n\n    protected override void Schedule(SchedulerEntry dataRow)\n    {\n        var source = RandomPositionFromGeometry(dataRow.SourceGeometry);\n        var target = RandomPositionFromGeometry(dataRow.TargetGeometry);\n\n\n        var traveler = new Traveler(TravelerLayer, source, target)\n        {\n            ResultTrajectoryEnabled = true\n        };\n\n        TravelerLayer.Travelers.Add(traveler.ID, traveler);\n        RegisterAgent(TravelerLayer, traveler);\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The above example creates a new ",(0,i.jsx)(n.code,{children:"Traveler"})," agent for each valid event, registers it with the runtime system and adds it to the layer."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var t=r(96540);const i={},d=t.createContext(i);function s(e){const n=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);