"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8876],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),c=s(n),u=i,g=c["".concat(l,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[c]="string"==typeof e?e:i,o[1]=p;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},63322:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>p,toc:()=>s});var a=n(87462),i=(n(67294),n(3905));const r={sidebar_position:10},o="Agent",p={unversionedId:"tutorial/development/agent",id:"tutorial/development/agent",title:"Agent",description:"Definition of Agents",source:"@site/docs/tutorial/development/agent.md",sourceDirName:"tutorial/development",slug:"/tutorial/development/agent",permalink:"/docs/tutorial/development/agent",draft:!1,editUrl:"https://github.com/daniel260/theraflow-doc/edit/main/docs/tutorial/development/agent.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"ModelDescription",permalink:"/docs/tutorial/development/model"},next:{title:"Entity",permalink:"/docs/tutorial/development/entity"}},l={},s=[{value:"Definition of Agents",id:"definition-of-agents",level:2},{value:"Implementation of Agents",id:"implementation-of-agents",level:2},{value:"Passing input to the Agent",id:"passing-input-to-the-agent",level:2},{value:"Direct value assignment",id:"direct-value-assignment",level:3},{value:"Indirect value assignment",id:"indirect-value-assignment",level:3},{value:"Alternative names",id:"alternative-names",level:3},{value:"Required properties",id:"required-properties",level:3}],d={toc:s};function c(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"agent"},"Agent"),(0,i.kt)("h2",{id:"definition-of-agents"},"Definition of Agents"),(0,i.kt)("p",null,"Along with ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/development/layers"},"layers"),", agents are the main part of every model. Once the layers have been created, agent types can be specified. For this step, the modeler needs to know what each agent type is going to be, what attributes define it, and what its actions will look like. Once this has been established, the agent type creation can be started."),(0,i.kt)("p",null,"Agents are the central part of the MARS simulation, which can be viewed as an information system with three phases. First, there is some kind of input data that is integrated in the model, either in layer or agent. The model execution is then performed and generates output data in different formats for analyzation."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"MARS simulation as information system",src:n(55397).Z,width:"639",height:"305"})),(0,i.kt)("p",null,"A more detailed view on the system emphasises that the input files are described in the ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/sim_config_options"},"simulation config"),". The input data is used to initialize certain properties of the agent, which may afterwards finalize the initialization process with model code. The model execution ticks the agent in every time step. The output is created automatically by the system. Output formats as well as filter criteria need to be defined in the simulation config. To analyze the results, as for now, external tools are required. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"MARS simulation as information system",src:n(13826).Z,width:"1191",height:"373"})),(0,i.kt)("h2",{id:"implementation-of-agents"},"Implementation of Agents"),(0,i.kt)("p",null,"Agent types are defined by implementing the ",(0,i.kt)("inlineCode",{parentName:"p"},"IAgent<TLayer>")," interface. The ",(0,i.kt)("inlineCode",{parentName:"p"},"IAgent<TLayer>")," interface expects the implementation of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Init(TLayer)")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"Tick()")," method as well as a unique identifier in form of a ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Universally_unique_identifier"},"UUID")," (",(0,i.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/dotnet/api/System.Guid?view=netstandard-2.0"},"Guid"),") which has to be assigned by the ",(0,i.kt)("inlineCode",{parentName:"p"},"ID")," property."),(0,i.kt)("p",null,"The agent and entity contract is structured as follows:"),(0,i.kt)("mermaid",{value:"classDiagram\n    class IModelObject {\n        <<interface>>\n    }\n\n    class IEntity {\n        <<interface>>\n    }\n\n    class ITickClient {\n        <<interface>>\n        +Tick()\n    }\n\n    class IAgent {\n        <<interface>>\n    }\n\n    class Guid {\n        <<interface>>\n    }\n\n    IModelObject <|-- IEntity\n    IModelObject <|-- ITickClient\n    IEntity <|-- IAgent\n    ITickClient <|-- IAgent\n\n    IEntity --\x3e Guid : ID"}),(0,i.kt)("p",null,"In the model code a ",(0,i.kt)("inlineCode",{parentName:"p"},"using")," import for the namespace ",(0,i.kt)("inlineCode",{parentName:"p"},"Mars.Interfaces.Agents")," must be added:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using Mars.Interfaces.Agents;\n")),(0,i.kt)("p",null,"An agent definition may look like this. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using Mars.Interfaces.Agents;\n\npublic class MyAgentType : IAgent<MyLayer> \n{\n    public void Init(MyLayer layer) \n    {\n        // finalize the init process\n    }\n    \n    public void Tick() \n    {\n        // define your logic here\n    }\n    \n    public Guid ID { get; set; }\n}\n")),(0,i.kt)("p",null,"Each agent type, which shall be available for the scenario configuration have to be registered within the ",(0,i.kt)("inlineCode",{parentName:"p"},"ModelDescription"),". "),(0,i.kt)("p",null,"Use method ",(0,i.kt)("inlineCode",{parentName:"p"},"AddAgent<TAgentType, TLayerType>()")," expects therefore the connection of the agents to its responsible layer:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"// Define the description when not already happened\n// var description = new ModelDescription();\n\n// Register the agent type before adding the agent type.\ndescription.AddLayer<MyLayerType>();\n\ndescription.AddAgent<MyAgentType, MyLayerType>();\n")),(0,i.kt)("p",null,"When each agent type is registered, the type and their parameter can be used within the ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/agent_config"},"scenario configuration"),". "),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Note that the respective layer type must be registered to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ModelDescription")," beforehand.")),(0,i.kt)("h2",{id:"passing-input-to-the-agent"},"Passing input to the Agent"),(0,i.kt)("p",null,"To initialize agents or entities with given inputs the ",(0,i.kt)("inlineCode",{parentName:"p"},"IAgentManager")," or the ",(0,i.kt)("inlineCode",{parentName:"p"},"IEntityManager")," is used. Both components read the scenario configuration and use the mapping to create objects from it."),(0,i.kt)("p",null,"For example, to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"IAgentManager"),", a layer (more on defining layers ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/development/layers"},"here"),") can be used to load the component that provides the ",(0,i.kt)("inlineCode",{parentName:"p"},"IAgentManager")," interface, for example inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"InitLayer()")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public class MyAgentLayer : AbstractLayer \n{\n    public override bool InitLayer(TInitData layerInitData, RegisterAgent registerAgentHandle, UnregisterAgent unregisterAgentHandle)\n    {\n        base.InitLayer(layerInitData, registerAgentHandle, unregisterAgentHandle);\n        // Resolve the required model component.\n        var agentManager = layerInitData.Container.Resolve<IAgentManager>();\n        \n        // Create and register objects of type MyAgentType.\n        var agents = agentManager.Spawn<MyAgentType>();\n        \n        // Otherwise only create them but do not registering \n        // to trigger their Tick() method. \n        var nonRegisteredAgents = agentManager.Create<MyAgentType>().ToList();\n        \n        return true;\n    }\n}\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Spawn<MyAgentType>()")," call creates and registers a set of agents from the configuration, unless otherwise specified in the call, and uses the mapping to assign properties of each ",(0,i.kt)("inlineCode",{parentName:"p"},"MyAgentType")," object with the desired value."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The number of agents is defined in the configuration via the ",(0,i.kt)("inlineCode",{parentName:"p"},"count")," switch.")),(0,i.kt)("admonition",{type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Spawn<MyAgentType>()")," call returns an ",(0,i.kt)("strong",{parentName:"p"},"iterator for creating and registering")," objects. The ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/de-de/dotnet/csharp/programming-guide/concepts/linq/"},".NET Language Integrated Query (LINQ)")," technology allows subsequent queries on the set of objects before they are actually created. Only when ",(0,i.kt)("inlineCode",{parentName:"p"},"ToList()")," is iterated or called do the statements actually pass through. ")),(0,i.kt)("p",null,"Using ",(0,i.kt)("inlineCode",{parentName:"p"},"PropertyDescription")," annotation for those parameters of an agent or entity which shall be assigned with input data from outside. Properties must be publicly visible and have both a ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," (getter) and ",(0,i.kt)("inlineCode",{parentName:"p"},"set")," (setter) to allow values to be written."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public class MyAgentType : IAgent<MyLayer> \n{\n    [PropertyDescription]\n    public double InputProperty { get; set; }\n\n\n\n    public void Init(MyLayer layer) { }\n    \n    public void Tick() \n    {\n        // do something with the input\n        Console.WriteLine(InputProperty);\n    }\n    \n    public Guid ID { get; set; }\n} \n\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"PropertyDescription")," is used to mark properties of a type to make this a scenario configuration (described ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorial/configuration/agent_config"},"here"),") externally visible."),(0,i.kt)("p",null,"Inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"mappings")," a value or indirection mapping can be done via the name of the model element (here ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty"),")."),(0,i.kt)("h3",{id:"direct-value-assignment"},"Direct value assignment"),(0,i.kt)("p",null,"Values for properties can be assigned to instances of a type directly in the configuration. A direct assignment assigns the property via a name (here ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty"),") with a desired value that conforms to the typing of the property (",(0,i.kt)("inlineCode",{parentName:"p"},"double"),"-precision value of ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "MyAgentType",\n  "mappings":[\n    {"name": "InputProperty", "value": 3.141 } \n  ]\n}\n')),(0,i.kt)("p",null,"The system tries to convert the input to the type automatically, so other input such as value written as ",(0,i.kt)("inlineCode",{parentName:"p"},'"3.14"')," are also possible. However, if the input does not conform to the given type, an exception is raised. For example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty")," which is typed as ",(0,i.kt)("inlineCode",{parentName:"p"},"double")," is assigned the value ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "MyAgentType",\n  "mappings":[\n    {"name": "InputProperty", "value": true } \n  ]\n}\n')),(0,i.kt)("p",null,"Then the system throws the following exception:"),(0,i.kt)("admonition",{type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"The type ",(0,i.kt)("inlineCode",{parentName:"p"},"Double")," for property ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty")," is not compatible with input ",(0,i.kt)("inlineCode",{parentName:"p"},"True"),".")),(0,i.kt)("h3",{id:"indirect-value-assignment"},"Indirect value assignment"),(0,i.kt)("p",null,"An ",(0,i.kt)("em",{parentName:"p"},"indirect value assignment")," allows to initialize each instance of an agent with its individual data objects. These data objects are stored in a file (for instance a csv-file), which is assigned to the agent type in the simulation config.\nA given source (here ",(0,i.kt)("inlineCode",{parentName:"p"},"myAgentType.csv"),") contains ",(0,i.kt)("em",{parentName:"p"},"x")," data objects (rows, without header row). Each data row represents one agent instance:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"fieldNameInCsv"),(0,i.kt)("th",{parentName:"tr",align:null},"anotherField"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"0.481"),(0,i.kt)("td",{parentName:"tr",align:null},"gold")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1.482"),(0,i.kt)("td",{parentName:"tr",align:null},"silver")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"79.13"),(0,i.kt)("td",{parentName:"tr",align:null},"copper")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"100.48"),(0,i.kt)("td",{parentName:"tr",align:null},"platinum")))),(0,i.kt)("p",null,"The attribute ",(0,i.kt)("inlineCode",{parentName:"p"},"fieldNameInCsv")," of the input ",(0,i.kt)("inlineCode",{parentName:"p"},"myAgentType.csv")," ",(0,i.kt)("strong",{parentName:"p"},"does not")," correspond to the name ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty")," of the model object. To access the values of the field, the field name must be specified to ",(0,i.kt)("em",{parentName:"p"},"redirect")," the access reading the source:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "MyAgentType",\n  "file": "myAgentType.csv",\n  "mappings":[\n    {"name": "InputProperty", "field": "fieldNameInCsv" }\n  ]\n}\n')),(0,i.kt)("h3",{id:"alternative-names"},"Alternative names"),(0,i.kt)("p",null,"Instead of the property name from the model (here ",(0,i.kt)("inlineCode",{parentName:"p"},"InputProperty"),") a field ",(0,i.kt)("inlineCode",{parentName:"p"},"Name")," with an alternative attribute name can be specified at the ",(0,i.kt)("inlineCode",{parentName:"p"},"PropertyDescription"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'public class MyAgentType : IAgent<MyLayer> \n{\n    [PropertyDescription(Name = "myOtherName"]\n    public double InputProperty { get; set; }\n} \n')),(0,i.kt)("p",null,"Mapping of values can now be specified via ",(0,i.kt)("inlineCode",{parentName:"p"},"MyInputProperty")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"myOtherName"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "MyAgentType",\n  "mappings":[\n    {"name": "myOtherName", "value": 3.141 }\n  ]\n}\n')),(0,i.kt)("h3",{id:"required-properties"},"Required properties"),(0,i.kt)("p",null,"Models that define parameters that ",(0,i.kt)("strong",{parentName:"p"},"must be externally mapped")," can specify this requirement as ",(0,i.kt)("inlineCode",{parentName:"p"},"Required")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"PropertyDescription"),". To initialize an object, there must then be a mapping for the respective annotated properties, otherwise the system throws an exception."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public class MyAgentType : IAgent<MyLayer> \n{\n    [PropertyDescription(Required = true)]\n    public double InputProperty { get; set; }\n} \n")))}c.isMDXComponent=!0},13826:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/agent_lifecycle-5d4dd76c7fd8b09122ff9d84d89aa284.png"},55397:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/mars_simulation_system-464703a4d0ffd85e3f53f724bd315b21.png"}}]);